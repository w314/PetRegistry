# Tutorial to Build Pets App

## Project Workflow
- Setup
  - initialize project
  - setup git repository
  - add db configuration
  - server should run when we start application
- Create model classes
- Create DAO interfaces
- Create service layer for business logic
- Create controllers to handle HTTP requests

## Project Setup

### Initialize App
- use [Spring Initializer](https://start.spring.io/) to generate app
    - Project: Maven
    - Language: Java
    - Spring Boot: 3.2.5
    - Project Metadata
        - Group: com.wp
        - Artifact: Pets
        - Name: (same as artifact)
        - Package name: (generated)
        - Packaging: Jar
        - Java: 17
    - Dependencies
        - Spring Web
        - Spring Data JPA
        - PostgreSQL Driver

- Generate Application
- Extract Downloaded files to appropriate directory
- (application won't run until db connection is setup)
## Setup GIT
- `cd` into project directory
-  run `git init`
-  setup remote repository
- add remore repository `git remote add origin <repoName>`
- make initial commit

## Setup Database Connection
Add to `src/main/resources/application.properties`:
```bash
# database credentials - needed to connect to a database

spring.datasource.url=jdbc:postgresql://localhost:5432/postgres
spring.datasource.username=postgres
spring.datasource.password=password


# spring data settings

# allows to see sql running in the console
spring.jpa.show-sql=true

# sets DDL to update when change happens (create would drop the db and recreate it)
spring.jpa.hibernate.ddl-auto=update

# specifies the db schema we are pointing to
spring.jpa.properties.hibernate.default_schema=public
```
Server will start without error after this one.

## Create Models
### Create package models 
  - under `src\main\java\com.wp.Pets`
  - right click `com.wp.Pets` select `New`-> `Package`
  - add name `models`

### Create model class file for Pet
  - under `src\main\java\com.wp.Pets\models`
  - right click `models` select `New` -> `Java Class`
  - add name `Pet`


### Create Model classes

#### Start from regular Java class syntax

PET:
```java
// package declaration
package com.wp.Pets.models;

public class Pet {

    private int petId;
    private String name;
    private String type;
    private Owner owner;

    // CONSTRUCTORS + SETTERS AND GETTERS + TOSTRING
}
```

OWNER
```java
package com.wp.Pets.models;
// no need to import Pet model as it is in the same package as Owner

public class Owner {

    private int ownerId;
    private String name;
    private List<Pet> pets;
    
    // CONSTRUCTORS + SETTERS AND GETTERS + TOSTRING
}
```
Intellij let's you generate constructors/getter-setters/toString
- click in the code where you want the generated code to be instered
- right click `Generate` ->
  - `Constructor` no args (click `Select None`) or select args you need
  - `Getter and Setter` select args you need getters and setters for
  - `toString`

#### Mark classes as DB entities and components
```java
// @Entity makes the class a DB table
@Entity
// @Table specifies the name of the table
@Table(name="pets") 
// @Component makes the class a bean
@Component
public class Pet { // ... 
}
```
- same for Owner class with `@Table(name="owners")`

#### Set up constrains

Specify the Primary Key
```java
    // @Id and @GeneratedValue together specify an autogenerated primary key
    @Id
    // strategy defines how we want to generate our values
    @GeneratedValue(strategy=GenerationType.IDENTITY)
    private int id;
```

Set up not null constrain if needed
```java
// @Column is not necessary to create a db column
// all fields will be columns unless marked by @Transient
// @Column let's us set constrains on the column
@Column(nullable = false)
private String name;
```

### Set up relationship between the tables

Owners and pets have a one to many relationship where one owner can have many pets

OWNER
```java
// code below sets up the one to many relationship between owner and pet
// where one owner can have many pets
// @OneToMany specifies that this is the one side of the relationship
// mappedBy specifies the name of the field in the other class
// where the primary key of the owner would serve as a foreign key
@OneToMany(mappedBy = "owner", cascade = CascadeType.ALL)
private List<Pet> pets;
```

PET
```java
    // this code sets of the many side of the many to one relationship between pet and owner
    // each owner can have many pets, but pets can have only one owner
    // this does not need the @Column as there are no constrains (it can be null, pets)
    // @ManyToOne specifies that this is the many side of the relationship
    @ManyToOne(fetch = FetchType.EAGER)
    // @JoinColumns specifies the column name on the one side of the relationship, the primary key in the other table
    @JoinColumn(name="ownerId")
    private Owner owner;
```

### Update main class
Add to main class:
```java
// @EntityScan makes Spring to scan for entities in the folder specified
@EntityScan("com.wp.Pets.models")
// @ComponentScan makes Spring to scan for beans in the folder specified
@ComponentScan("com.wp.Pets")
public class PetsApplication {}
```
If the app is restarted, the two tables are created and can be viewed in dBeaver.

## Create DAOs
DAOs handle the CRUD operations on the database.
- create new package name daos under com.wp.Pets
- create PetDAO interface: right click -> New -> Java Class -> Select Interface
- create OwnerDAO interface

PET DAO example:
```java
@Repository
public interface PetDAO extends JpaRepository<Pet, Integer> {
}
```
- `@Repository` makes it a bean and signals that is a repository 
- has to extend `JPARepository<Pet, Integer>`
- with the name of the model: Pet 
- and the wrapper class of the type of the primary key as types

## Create Controllers
Controller will respond to incoming HTTP requests

- create controllers package
- create controller classes both for pet and owner